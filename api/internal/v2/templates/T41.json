{
  "template_registry": {
    "registry_version": "1.1.0",
    "scope": "math_1_4",
    "source": {
      "prompt_reference": "prompt_generate_math_templates_T1_T44.final.v2.updated_after_audit_T1_T5.txt",
      "generated_at": "2025-12-13T09:47:05Z",
      "notes": [
        "SINGLE TEMPLATE EXPORT (T41 only).",
        "Основан на описании T41 в педдокументе и routing_keys_table_v1.xlsx; без добавления новых ключей, но с расширением enums.constraints_enum значением 'use_each_once'."
      ]
    },
    "enums": {
      "task_type_enum": [
        "number_sense",
        "numeral_systems",
        "arithmetic_fluency",
        "fractions_percent",
        "word_problems",
        "measurement_units",
        "geometry",
        "data_representation",
        "patterns_logic"
      ],
      "format_enum": [
        "plain_text",
        "inline_examples",
        "column",
        "fill_gaps",
        "table",
        "diagram",
        "number_line",
        "grid",
        "drawing",
        "mixed"
      ],
      "constraints_enum": [
        "needs_visual",
        "has_table",
        "has_diagram",
        "has_number_line",
        "has_grid",
        "has_drawing",
        "multi_step",
        "unit_conversion",
        "roman_numerals",
        "fraction_notation",
        "percent",
        "trick_question",
        "use_each_once"
      ],
      "template_params_keys": [
        "ops",
        "range_max",
        "written_algorithm",
        "unknown_component",
        "compare_mode",
        "change_mode",
        "word_model",
        "unit_kind",
        "data_task_mode",
        "geometry_mode",
        "logic_mode"
      ]
    },
    "templates": [
      {
        "template_code": "T41",
        "template_id": "T41_pedagogical_template",
        "title": "Логические задачи и комбинаторика",
        "grade_min": 2,
        "grade_max": 4,
        "formats_allowed": [
          "plain_text",
          "mixed"
        ],
        "ped_keys_defaults": {
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "combinatorics",
          "constraints": [
            "use_each_once"
          ],
          "template_params_defaults": {
            "ops": [
              "add",
              "sub",
              "mul",
              "div"
            ],
            "logic_mode": "combinatorics",
            "word_model": "logic_distribution",
            "change_mode": "none",
            "compare_mode": "none",
            "geometry_mode": null,
            "unit_kind": null,
            "range_max": null,
            "unknown_component": null,
            "data_task_mode": null
          }
        },
        "routing": {
          "match_keys": {
            "task_type": "patterns_logic",
            "topic": "combinatorics",
            "formats_allowed": [
              "plain_text",
              "mixed"
            ]
          },
          "routing_rules": [
            {
              "rule_id": "T41_WHO_WHERE_SEATING",
              "must_have": {
                "text_patterns_any": [
                  "кто где живет",
                  "кто где живёт",
                  "кто где сидит",
                  "посади",
                  "рассад",
                  "пересад",
                  "поменять местами",
                  "сколько разных способов",
                  "сколькими способами"
                ],
                "visual_kinds_any": [],
                "template_params_required": {}
              },
              "must_not": {
                "text_patterns_any": [
                  "скорость",
                  "расстояние",
                  "км/ч",
                  "температура",
                  "процент",
                  "процента",
                  "процентов"
                ],
                "visual_kinds_any": []
              },
              "routing_priority": 78,
              "tie_breaker": "(1) 0 нарушений must_not; (2) больше совпадений фраз про рассадку и варианты; (3) выше routing_priority."
            },
            {
              "rule_id": "T41_POURING_AND_WEIGHING",
              "must_have": {
                "text_patterns_any": [
                  "перелив",
                  "переливая",
                  "перелить",
                  "взвешив",
                  "взвес",
                  "на весах",
                  "чашечных весах"
                ],
                "visual_kinds_any": [],
                "template_params_required": {}
              },
              "must_not": {
                "text_patterns_any": [
                  "просто реши пример",
                  "таблица умножения"
                ],
                "visual_kinds_any": []
              },
              "routing_priority": 77,
              "tie_breaker": "(1) 0 нарушений must_not; (2) наличие маркеров 'перелив'/'взвешив'; (3) выше routing_priority."
            },
            {
              "rule_id": "T41_COUNT_VARIANTS",
              "must_have": {
                "text_patterns_any": [
                  "сколько разных вариантов",
                  "сколько различных вариантов",
                  "сколькими способами",
                  "сколько комбинаций"
                ],
                "visual_kinds_any": [],
                "template_params_required": {}
              },
              "must_not": {
                "text_patterns_any": [
                  "произведение",
                  "периметр",
                  "площадь"
                ],
                "visual_kinds_any": []
              },
              "routing_priority": 76,
              "tie_breaker": "(1) 0 нарушений must_not; (2) наличие маркеров 'сколько вариантов/способов'; (3) выше routing_priority."
            }
          ],
          "confusables": [
            "T37",
            "T38",
            "T43"
          ]
        },
        "hint_policy_defaults": {
          "default_visible": 2,
          "max_hints": 3,
          "h3_reason": "Для логических задач и комбинаторики полезен третий шаг с проверкой всех вариантов и обсуждением, почему других нет."
        },
        "notes_for_backend": [
          "T41: логические задачи и комбинаторика (по педдокументу).",
          "Основные виды задач: 'кто где живёт/сидит', задачи на переливания и взвешивания, подсчёт числа вариантов.",
          "task_type='patterns_logic', constraints включают 'use_each_once', logic_mode='combinatorics', word_model='logic_distribution' строго по routing_keys_table_v1.xlsx."
        ]
      }
    ],
    "routing_tests": [
      {
        "id": "RT_T41_SEATING",
        "kind": "positive",
        "description": "Трое друзей — Аня, Боря и Вика — сидят на трёх стульях в ряд. Сколькими способами они могут рассесться?",
        "expected": {
          "template_id": "T41_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "combinatorics"
        },
        "why": "Задача на количество вариантов рассадки, ключевые маркеры 'сколькими способами' и рассадка."
      },
      {
        "id": "RT_T41_POURING",
        "kind": "positive",
        "description": "Есть два сосуда: 5 л и 3 л. Как с помощью переливаний отмерить 4 л воды?",
        "expected": {
          "template_id": "T41_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "combinatorics"
        },
        "why": "Классическая задача на переливания с пошаговыми действиями и логическими ограничениями."
      }
    ]
  },
  "template_profiles": {
    "T41_pedagogical_template": {
      "hint_style_profile": "logic_combinatorics",
      "max_hints_default": 3,
      "age_language": {
        "grade_min": 2,
        "grade_max": 4,
        "tone": "спокойный/поддерживающий",
        "complexity_rules": [
          "объяснять рассуждения пошагово: какие варианты возможны и почему.",
          "использовать простые таблицы, схемы или списки для систематизации вариантов.",
          "не перегружать ребёнка формальной терминологией комбинаторики; опираться на сюжеты (кто где сидит, как переливать и т.п.)."
        ]
      },
      "teaching_pattern": {
        "goal": "Учиться рассуждать по условиям, систематизировать варианты и отбрасывать невозможные в логических задачах и задачах на комбинаторику.",
        "l1": {
          "rules": [
            "Пиши по строкам: 1 строка = 1 действие. Последний шаг оставляй с __ (без готового ответа).",
            "Внимательно прочитать условие и выписать всех участников/объекты задачи (людей, сосуды, предметы).",
            "Отметить ключевые ограничения: кто не может сидеть/жить где-то, сколько налито, какие взвешивания разрешены.",
            "Сделать простую схему или таблицу, чтобы наглядно увидеть возможные варианты.",
            "Если есть ёмкости/объекты разной наполненности (полная/половина/пустая или другие доли) — назначь каждой доле удобное число (например 1, 1/2, 0) и посчитай общий объём/количество ресурса и общее число ёмкостей/объектов."
          ],
          "format": "Понимание условия и фиксация ограничений.",
          "forbidden": [
            "сразу подбирать вариант наугад без анализа ограничений.",
            "игнорировать явно указанные в задаче запреты и условия.",
            "выдавать готовый финальный ответ (число/формулировку) или писать «Ответ:»."
          ]
        },
        "l2": {
          "rules": [
            "Пиши по строкам: 1 строка = 1 действие. Последний шаг оставляй с __ (без готового ответа).",
            "Пошагово перебирать варианты, исключая невозможные по условиям задачи.",
            "Для задач на переливания или взвешивания описывать каждый шаг (что куда перелили, какое взвешивание сделали).",
            "Отмечать варианты, которые подходят всем условиям, и объяснять словами, почему они подходят.",
            "Если нужно разделить поровну между несколькими участниками: раздели общее число объектов и общий объём/количество ресурса на число участников. Потом подбирай равные наборы объектов так, чтобы у каждого было и столько же объектов, и столько же ресурса."
          ],
          "format": "Систематизация вариантов и поиск решения с опорой на ограничения.",
          "forbidden": [
            "перескакивать к ответу без объяснения, почему отпали другие варианты.",
            "давать слишком много вариантов сразу, не поясняя их проверку.",
            "выдавать готовый финальный ответ (число/формулировку) или писать «Ответ:»."
          ]
        },
        "l3": {
          "when_allowed": "если max_hints_default == 3 и ребёнок уже увидел, как находятся подходящие варианты.",
          "rules": [
            "Пиши по строкам: 1 строка = 1 действие. Последний шаг оставляй с __ (без готового ответа).",
            "Организовать самопроверку: пройтись по условиям задачи и проверить, что найденное решение их не нарушает.",
            "Предложить ребёнку сформулировать своими словами, почему других подходящих вариантов нет или сколько их всего.",
            "Привести очень короткий похожий пример, где ребёнок попробует сам систематизировать варианты.",
            "Проверка набора: у каждого одинаковое число объектов и одинаковое количество ресурса; вместе все наборы используют ровно все имеющиеся объекты каждого типа/доли заполнения."
          ],
          "format": "Самопроверка и закрепление навыка систематизации вариантов.",
          "forbidden": [
            "вводить новые, более сложные типы логических задач на этом уровне.",
            "менять исходный сюжет задачи.",
            "выдавать готовый финальный ответ (число/формулировку) или писать «Ответ:»."
          ]
        }
      },
      "common_mistakes": [
        "Не учитывает все условия задачи (игнорирует один или несколько запретов).",
        "Перебирает варианты хаотично, из‑за чего пропускает или повторяет варианты.",
        "Считает только один найденный вариант, хотя по условию нужно найти все возможные.",
        "Делает неверные выводы при переливаниях или взвешиваниях (например, не сохраняет общий объём или массу)."
      ],
      "terminology_rules": [
        "Слова 'вариант', 'ограничение', 'подходит/не подходит' вводить через конкретные примеры задач.",
        "Не перегружать терминами 'комбинаторика', 'перестановки'; достаточно говорить про 'разные способы'.",
        "Подчёркивать важность систематического перебора, а не угадывания."
      ],
      "disclosure_defaults": {
        "h1": "none",
        "h2": "partial",
        "h3": "partial"
      },
      "hint_style": {
        "one_action_per_line": true,
        "use_placeholders_in_last_step": true,
        "placeholders": [
          "__",
          "□",
          "?"
        ],
        "no_final_answer": true,
        "no_impossibility_claim_without_check": true,
        "math_self_check_required": true
      },
      "hint_micro_playbooks": {
        "TRANSFORMATIONS_BY_STEPS": {
          "when_text_has_any": [
            "капл",
            "превращ",
            "становитс",
            "в кого",
            "за 1"
          ],
          "L1": "Нарисуй схему со стрелками: кто в кого превращается за 1 шаг. Потом просто «иди по стрелкам» и считай шаги.",
          "L2": "Для каждого вопроса делай короткий поиск: начни от нужного героя и выпиши 3–6 шагов. Если повторился герой — начался круг.",
          "L3": "Если попал в круг, проверь: есть ли нужный герой в этом круге. Итог запиши так: «получилось/не получилось» и количество шагов оставь с __."
        },
        "AGES_SUMS": {
          "when_text_has_any": [
            "лет",
            "возраст",
            "старше",
            "младше",
            "вместе"
          ],
          "L1": "Найди сумму возрастов нужной группы: «все вместе» − «часть вместе» = __.",
          "L2": "Проверь, хватает ли условий, чтобы разделить сумму на отдельных детей. Если вариантов несколько — покажи 2 разных примера, которые подходят.",
          "L3": "Сделай вывод: возраст можно/нельзя узнать однозначно. Если можно — последний шаг оставь: __."
        },
        "LETTER_COSTS": {
          "when_text_has_any": [
            "дом",
            "вход",
            "выход",
            "букв",
            "надпис"
          ],
          "L1": "Выпиши буквы и посчитай, сколько раз каждая буква встречается в каждой надписи.",
          "L2": "Составь 2–3 равенства по времени (как суммы «стоимостей букв») и сравни их, чтобы узнать стоимость одной буквы.",
          "L3": "Сложи стоимости букв нужного слова. Последнее сложение оставь ребёнку: __."
        },
        "BALANCE_WEIGHING_TARGET_5KG": {
          "when_text_has_any": [
            "взвеш",
            "гири",
            "весы",
            "чаш",
            "соль",
            "сахар"
          ],
          "L1": "Цель — получить 5 кг нужного вещества. Сначала отмерь 1 кг одной из сыпучестей так, как это разрешено условием (обычно с гирей 1 кг), и обязательно подпиши/отложи этот пакет, чтобы не перепутать.",
          "L2": "Стратегия удвоения 1–2–4: (1) получи 1 кг (подпиши), (2) с его помощью отмерь 2 кг, (3) с 2 кг отмерь 4 кг. Затем собери 5 кг как 4 кг + 1 кг (нужной сыпучести).",
          "L3": "Самопроверка: на каждом взвешивании массы на чашах равны; после каждого шага проверь, что пакет подписан правильно и там именно 1/2/4 кг. Если получилось другое число (например 3 кг), а нужно 5 кг — шаг неверный. Последние числа оставь с __."
        }
      }
    }
  }
}