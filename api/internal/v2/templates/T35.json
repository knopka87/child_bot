{
  "template_registry": {
    "registry_version": "1.1.0",
    "scope": "math_1_4",
    "source": {
      "prompt_reference": "prompt_generate_math_templates_T1_T44.final.v2.updated_after_audit_T1_T5.txt",
      "generated_at": "2025-12-13T09:58:01Z",
      "notes": [
        "SINGLE TEMPLATE EXPORT (T35 only).",
        "Основан на описании T35 в педдокументе и routing_keys_table_v1.xlsx без добавления новых ключей."
      ]
    },
    "enums": {
      "task_type_enum": [
        "number_sense",
        "numeral_systems",
        "arithmetic_fluency",
        "fractions_percent",
        "word_problems",
        "measurement_units",
        "geometry",
        "data_representation",
        "patterns_logic"
      ],
      "format_enum": [
        "plain_text",
        "inline_examples",
        "column",
        "fill_gaps",
        "table",
        "diagram",
        "number_line",
        "grid",
        "drawing",
        "mixed"
      ],
      "constraints_enum": [
        "needs_visual",
        "has_table",
        "has_diagram",
        "has_number_line",
        "has_grid",
        "has_drawing",
        "multi_step",
        "unit_conversion",
        "roman_numerals",
        "fraction_notation",
        "percent",
        "trick_question"
      ],
      "template_params_keys": [
        "ops",
        "range_max",
        "written_algorithm",
        "unknown_component",
        "compare_mode",
        "change_mode",
        "word_model",
        "unit_kind",
        "data_task_mode",
        "geometry_mode",
        "logic_mode"
      ]
    },
    "templates": [
      {
        "template_code": "T35",
        "template_id": "T35_pedagogical_template",
        "title": "Арифметические выражения и порядок действий",
        "grade_min": 2,
        "grade_max": 4,
        "formats_allowed": [
          "plain_text",
          "mixed"
        ],
        "ped_keys_defaults": {
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "arith_expressions_order",
          "constraints": [],
          "template_params_defaults": {
            "ops": [
              "add",
              "sub",
              "mul",
              "div"
            ],
            "logic_mode": "patterns",
            "word_model": "expression_order",
            "change_mode": "none",
            "compare_mode": "none",
            "geometry_mode": null,
            "unit_kind": null,
            "range_max": null,
            "unknown_component": null,
            "data_task_mode": null
          }
        },
        "routing": {
          "match_keys": {
            "task_type": "patterns_logic",
            "topic": "arith_expressions_order",
            "formats_allowed": [
              "plain_text",
              "mixed"
            ]
          },
          "routing_rules": [
            {
              "rule_id": "T35_CALCULATE_EXPRESSION",
              "must_have": {
                "text_patterns_any": [
                  "вычисли выражение",
                  "вычислите выражение",
                  "найди значение выражения",
                  "найдите значение выражения",
                  "вычисли устно",
                  "вычислите устно",
                  "порядок действий",
                  "в каком порядке",
                  "(расставь|поставь)(те)? скобки",
                  "выполни(те)? действия",
                  "сначала (умножение|деление)",
                  "(составь|запиши)(те)? выражение",
                  "записать выражением",
                  "(расставь|укажи)(те)? порядок",
                  "пронумеруй(те)? действия"
                ],
                "visual_kinds_any": [],
                "template_params_required": {}
              },
              "must_not": {
                "text_patterns_any": [
                  "таблица умножения",
                  "реши задачу",
                  "текстовая задача"
                ],
                "visual_kinds_any": []
              },
              "routing_priority": 67,
              "tie_breaker": "(1) 0 нарушений must_not; (2) наличие формулировок про 'значение выражения' или 'вычисли устно'; (3) выше routing_priority."
            }
          ],
          "confusables": [
            "T5",
            "T6",
            "T16",
            "T44"
          ]
        },
        "hint_policy_defaults": {
          "default_visible": 2,
          "max_hints": 3,
          "h3_reason": "Для выражений и порядка действий полезен третий шаг с самопроверкой и обсуждением, почему действия выполняются именно в таком порядке."
        },
        "notes_for_backend": [
          "T35: арифметические выражения и порядок действий (по педдокументу).",
          "Типичные задачи: запись выражений по тексту; вычисление выражений со скобками и без.",
          "task_type='patterns_logic', logic_mode='patterns', word_model='expression_order' и ops=['add','sub','mul','div'] строго по routing_keys_table_v1.xlsx.",
          "На бэке дополнительно используется флаг derived.has_expression_structure=true и derived.has_sequence_pattern=false для разведения с T34."
        ]
      }
    ],
    "routing_tests": [
      {
        "id": "RT_T35_EXPRESSION_VALUE",
        "kind": "positive",
        "description": "Найди значение выражения: (40 + 30) · 2 - 10.",
        "expected": {
          "template_id": "T35_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "arith_expressions_order"
        },
        "why": "Классическое задание на вычисление значения выражения с учётом порядка действий."
      },
      {
        "id": "RT_T35_ORAL_CALC",
        "kind": "positive",
        "description": "Вычисли устно: 50 + 40 : 30 · 50 - 100.",
        "expected": {
          "template_id": "T35_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "arith_expressions_order"
        },
        "why": "Задача на устное вычисление выражения без сюжета, что соответствует T35."
      },
      {
        "id": "RT_T35_ORDER_QUESTION",
        "kind": "positive",
        "description": "В каком порядке выполняются действия в выражении 8 + 2 × 5 - 3?",
        "expected": {
          "template_id": "T35_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "arith_expressions_order"
        },
        "why": "Прямой вопрос про порядок действий."
      },
      {
        "id": "RT_T35_BRACKETS",
        "kind": "positive",
        "description": "Расставь скобки так, чтобы значение выражения 2 + 3 × 4 равнялось 20.",
        "expected": {
          "template_id": "T35_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "arith_expressions_order"
        },
        "why": "Задание на расстановку скобок для изменения порядка действий."
      },
      {
        "id": "RT_T35_COMPOSE",
        "kind": "positive",
        "description": "Составь выражение по условию: из суммы чисел 12 и 8 вычесть произведение 3 и 4.",
        "expected": {
          "template_id": "T35_pedagogical_template",
          "task_type": "patterns_logic",
          "format": "plain_text",
          "topic": "arith_expressions_order"
        },
        "why": "Задание на составление выражения по словесному описанию."
      }
    ]
  },
  "template_profiles": {
    "T35_pedagogical_template": {
      "hint_style_profile": "arith_expressions_order",
      "max_hints_default": 3,
      "age_language": {
        "grade_min": 2,
        "grade_max": 4,
        "tone": "спокойный/поддерживающий",
        "complexity_rules": [
          "объяснять порядок действий на простых примерах (сначала в скобках, затем умножение/деление, потом сложение/вычитание).",
          "помогать переводить короткий текст в выражение, не перегружая формальной терминологией.",
          "по возможности предлагать ребёнку прикинуть результат, чтобы заметить явные ошибки."
        ]
      },
      "teaching_pattern": {
        "goal": "Учиться записывать арифметические выражения по тексту и правильно выполнять действия по порядку.",
        "l1": {
          "rules": [
            "Разобрать текст короткой задачи и выделить числа и слова, которые подсказывают операции (плюс, минус, умножить, разделить).",
            "Показать, как по этому тексту составить арифметическое выражение.",
            "Обсудить, какие действия в выражении будут выполняться раньше, а какие позже (скобки, умножение/деление, сложение/вычитание).",
            "Напомнить, что в этих примерах действия выполняются строго сверху вниз по цепочке (каждая строка использует результат предыдущей)."
          ],
          "format": "Понимание связи между текстом и выражением, введение порядка действий.",
          "forbidden": [
            "сразу выполнять вычисления, не проговорив порядок действий.",
            "вводить сложные обозначения без привязки к конкретному примеру.",
            "выдавать готовый финальный ответ (число/формулировку) или писать «Ответ:»."
          ]
        },
        "l2": {
          "rules": [
            "Пошагово выполнить вычисления в выражении, строго следуя порядку действий.",
            "Показывать промежуточные результаты после каждого шага (после скобок, после умножения/деления и т.д.).",
            "Обратить внимание на типичные места ошибок (перепутали порядок, забыли одну из операций).",
            "Если в задании есть подпункты (а, б, в...) — объясни один общий алгоритм и как применять его к каждому подпункту; подсказки должны относиться ко всему заданию целиком.",
            "Можно разобрать ОДИН подпункт как образец: показать промежуточные результаты, но финальный результат подпункта ученик считает сам."
          ],
          "format": "Пошаговое вычисление выражений со скобками и без.",
          "forbidden": [
            "перескакивать сразу к окончательному ответу.",
            "менять порядок действий ради упрощения, не объясняя почему так можно.",
            "выдавать готовый финальный ответ (число/формулировку) или писать «Ответ:»."
          ]
        },
        "l3": {
          "when_allowed": "если max_hints_default == 3 и ребёнок уже увидел пример пошагового решения.",
          "rules": [
            "Организовать самопроверку: предложить ребёнку прикинуть результат (округлить числа) и сравнить с полученным ответом.",
            "Попросить ребёнка объяснить, какие действия он выполнял сначала, а какие потом.",
            "Дать короткий похожий пример, чтобы ребёнок попробовал сам составить выражение и указать порядок действий.",
            "В L3 дай полный разбор хода решения по всему заданию, но оставь ученику выполнить финальный расчёт/записать итог самостоятельно; добавь самопроверку обратным действием.",
            "Самопроверка для цепочки: после деления число становится меньше (если делим на число > 1); после умножения — больше; при вычитании на N результат уменьшается на N; при прибавлении на N — увеличивается на N (N — число из условия)."
          ],
          "format": "Самопроверка и закрепление понимания порядка действий.",
          "forbidden": [
            "вводить новые, более сложные типы выражений.",
            "расширять задание до текстовых задач на этом уровне.",
            "выдавать готовый финальный ответ (число/формулировку) или писать «Ответ:»."
          ]
        }
      },
      "common_mistakes": [
        "Игнорирует порядок действий (сначала выполняет сложение/вычитание, а не умножение/деление).",
        "Неправильно обрабатывает скобки (забывает выполнить действие в скобках первым).",
        "Неверно переводит текст в выражение (меняет порядок чисел или операций).",
        "Пропускает одно из действий при вычислении длинных выражений."
      ],
      "terminology_rules": [
        "Слова 'выражение' и 'порядок действий' объяснять через конкретные примеры.",
        "Вместо формальных терминов можно говорить 'сначала считаем в скобках, потом умножаем/делим, потом складываем/вычитаем'.",
        "Подчёркивать, что аккуратная запись выражения помогает не ошибиться при вычислениях."
      ],
      "disclosure_defaults": {
        "h1": "none",
        "h2": "partial",
        "h3": "partial"
      }
    }
  }
}